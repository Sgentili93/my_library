import csv
import os

FILENAME = "bibliotheque.csv"
HEADER = ["Genre", "Auteur", "Ann√©e", "Titre", "Emprunt√©"]
GENRES_VALIDES = ["Roman", "Science-fiction", "Fantastique", "Policier", "Historique", "Biographie", "Philosophie", "Essai"]

# Fonction pour charger les livres depuis le fichier CSV
def charger_livres():
    if not os.path.exists(FILENAME):
        with open(FILENAME, "w", newline="", encoding="utf-8") as f:
            writer = csv.writer(f)
            writer.writerow(HEADER)
        return []
    
    with open(FILENAME, "r", newline="", encoding="utf-8") as f:
        reader = csv.reader(f)
        livres = list(reader)
    
    if livres and livres[0] == HEADER:
        return livres[1:]  # Exclure l'en-t√™te
    return livres

# Fonction pour enregistrer les livres dans le fichier CSV
def sauvegarder_livres(livres):
    with open(FILENAME, "w", newline="", encoding="utf-8") as f:
        writer = csv.writer(f)
        writer.writerow(HEADER)
        writer.writerows(livres)

# Fonction pour trier les livres par Genre -> Auteur -> Ann√©e
def trier_livres(livres):
    return sorted(livres, key=lambda x: (x[0].lower(), x[1].lower(), int(x[2])))

# Fonction pour ajouter un livre
def ajouter_livre():
    print("\nGenres disponibles :")
    for i, genre in enumerate(GENRES_VALIDES, start=1):
        print(f"{i}. {genre}")

    while True:
        choix_genre = input("\nChoisissez un num√©ro pour le genre : ").strip()
        if choix_genre.isdigit() and 1 <= int(choix_genre) <= len(GENRES_VALIDES):
            genre = GENRES_VALIDES[int(choix_genre) - 1]
            break
        print("‚ö†Ô∏è Veuillez entrer un num√©ro valide.")

    auteur = input("Auteur du livre : ").strip()
    annee = input("Ann√©e de publication : ").strip()
    titre = input("Titre du livre : ").strip()

    while True:
        emprunte = input("Emprunt√© ? (oui/non) : ").strip().lower()
        if emprunte in ["oui", "non"]:
            break
        print("‚ö†Ô∏è Veuillez entrer 'oui' ou 'non'.")

    livres = charger_livres()
    livres.append([genre, auteur, annee, titre, emprunte])
    livres = trier_livres(livres)
    sauvegarder_livres(livres)

    print("\n‚úÖ Livre ajout√© et biblioth√®que mise √† jour !\n")

# Fonction principale
def main():
    while True:
        print("\n1. Ajouter un livre")
        print("2. Afficher la biblioth√®que")
        print("3. Quitter")
        choix = input("Choisissez une option : ").strip()

        if choix == "1":
            ajouter_livre()
        elif choix == "2":
            livres = charger_livres()
            if not livres:
                print("\nüìö La biblioth√®que est vide.\n")
            else:
                print("\nüìñ Biblioth√®que tri√©e :")
                for livre in livres:
                    print(livre)
        elif choix == "3":
            print("\nüëã Au revoir !")
            break
        else:
            print("\n‚ö†Ô∏è Option invalide, veuillez entrer 1, 2 ou 3.\n")

# Ex√©cuter le programme
if __name__ == "__main__":
    main()
